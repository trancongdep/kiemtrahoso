<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Quản Lý Hồ Sơ QLKT & QLVH - Version 1.3 (Auth)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: #cbd5e0; border-radius: 10px; }
        
        .loader {
            border-top-color: #3498db;
            -webkit-animation: spinner 1.5s linear infinite;
            animation: spinner 1.5s linear infinite;
        }
        @keyframes spinner {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        input[type=checkbox] { transform: scale(1.6); margin: 5px; }
    </style>
</head>
<body class="bg-gray-100 min-h-screen text-sm pb-24 relative">

    <div id="login-overlay" class="fixed inset-0 bg-blue-900 z-[100] flex flex-col items-center justify-center text-white">
        <div class="mb-6 text-center">
            <i class="fas fa-bolt text-5xl text-yellow-400 mb-4"></i>
            <h1 class="text-3xl font-bold uppercase">Quản Lý Hồ Sơ Tổ 2</h1>
            <p class="text-blue-300 mt-2">Vui lòng đăng nhập để tiếp tục</p>
        </div>
        <button onclick="loginGoogle()" class="bg-white text-gray-800 px-8 py-3 rounded-full font-bold shadow-lg hover:bg-gray-100 transition flex items-center gap-3 text-lg">
            <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" class="w-6 h-6">
            Đăng nhập bằng Gmail
        </button>
        <p class="mt-8 text-xs text-blue-400">Version 1.3 - Secure Login & Audit Log</p>
    </div>

    <div id="app-content" class="hidden">
        
        <header class="bg-blue-800 text-white p-3 shadow-md flex justify-between items-center sticky top-0 z-50">
            <div class="flex items-center overflow-hidden">
                <i class="fas fa-folder-open text-yellow-400 mr-2 text-lg"></i>
                <div>
                    <h1 class="font-bold uppercase text-sm md:text-lg truncate leading-tight">QL Hồ Sơ Tổ 2</h1>
                    <div id="user-info" class="text-[10px] text-blue-200 flex items-center">
                        </div>
                </div>
            </div>
            <button onclick="logout()" class="text-xs bg-blue-900 hover:bg-red-600 px-3 py-1 rounded text-white transition ml-2 whitespace-nowrap">
                <i class="fas fa-sign-out-alt"></i> Thoát
            </button>
        </header>

        <div class="container mx-auto p-2 md:p-4 max-w-7xl">
            
            <div class="bg-white p-3 rounded-lg shadow-sm mb-4 border border-gray-200 sticky top-[50px] z-40">
                <div class="flex justify-between items-end mb-2">
                    <label class="block text-gray-500 text-[10px] font-bold uppercase">Chọn Tuyến / Trạm:</label>
                    <div id="last-update-info" class="text-[10px] text-right italic text-gray-400">
                        </div>
                </div>
                
                <div class="flex gap-2">
                    <div class="relative w-full">
                        <select id="routeSelect" class="block appearance-none w-full bg-gray-50 border border-gray-300 text-gray-800 py-2 px-3 pr-8 rounded focus:outline-none focus:border-blue-500 font-medium text-sm">
                            <option value="" disabled selected>-- Chọn hồ sơ làm việc --</option>
                        </select>
                        <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-gray-700">
                            <i class="fas fa-chevron-down text-xs"></i>
                        </div>
                    </div>
                    <button onclick="loadData()" class="bg-gray-200 text-gray-600 px-3 rounded hover:bg-gray-300 transition flex-shrink-0" title="Tải lại">
                        <i class="fas fa-sync-alt"></i>
                    </button>
                </div>
            </div>

            <div id="loading" class="hidden flex justify-center items-center p-10">
                <div class="loader ease-linear rounded-full border-4 border-t-4 border-gray-200 h-10 w-10"></div>
            </div>

            <div class="bg-transparent md:bg-white md:shadow-lg md:rounded-lg overflow-hidden">
                <table class="w-full text-left border-collapse">
                    <thead class="hidden md:table-header-group">
                        <tr class="bg-gray-100 text-gray-600 uppercase text-xs leading-normal border-b-2 border-gray-200">
                            <th class="py-3 px-4 text-center w-12">STT</th>
                            <th class="py-3 px-4">Nội dung hồ sơ</th>
                            <th class="py-3 px-4 text-center w-20">Có</th>
                            <th class="py-3 px-4 w-1/3">Ghi chú / Số lượng</th>
                            <th class="py-3 px-4 w-40">Hình ảnh</th>
                        </tr>
                    </thead>
                    <tbody id="tableBody" class="block md:table-row-group">
                        </tbody>
                </table>
            </div>
        </div>

        <button onclick="saveData()" class="fixed bottom-6 right-4 bg-blue-600 text-white w-14 h-14 rounded-full shadow-2xl flex items-center justify-center text-xl z-50 hover:bg-blue-700 active:scale-95 transition-all duration-200 border-2 border-white">
            <i class="fas fa-save"></i>
        </button>
    </div>

    <div id="toast" class="fixed top-20 left-1/2 transform -translate-x-1/2 px-4 py-3 rounded-lg shadow-xl transition-all duration-300 z-[60] flex items-center font-medium opacity-0 pointer-events-none min-w-[200px] justify-center text-sm">
        <span>Thông báo</span>
    </div>

    <input type="file" id="globalFileInput" class="hidden" accept="image/*">

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase, ref, set, get, child } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";
        import { getStorage, ref as sRef, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-storage.js";
        import { getAuth, signInWithPopup, GoogleAuthProvider, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

        // --- CONFIG ---
        const firebaseConfig = { 
            apiKey: "AIzaSyCzWjfcD5Dgq7V-i2izb9tKLR6QM6qWPQo", 
            authDomain: "tavietnam-78ae8.firebaseapp.com", 
            projectId: "tavietnam-78ae8", 
            storageBucket: "tavietnam-78ae8.firebasestorage.app", 
            messagingSenderId: "670121705534", 
            appId: "1:670121705534:web:1027ad98550573ad37116f" 
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);
        const storage = getStorage(app);
        const auth = getAuth(app);
        const provider = new GoogleAuthProvider();

        // --- STATE ---
        let currentUser = null;
        let currentUploadBtn = null;
        let currentRouteCode = null;

        // --- AUTH FUNCTIONS ---
        window.loginGoogle = () => {
            signInWithPopup(auth, provider)
                .then((result) => {
                    showToast("Đăng nhập thành công!", "success");
                }).catch((error) => {
                    console.error(error);
                    showToast("Lỗi đăng nhập: " + error.message, "error");
                });
        };

        window.logout = () => {
            signOut(auth).then(() => {
                showToast("Đã đăng xuất", "info");
                window.location.reload();
            });
        };

        // --- AUTH OBSERVER ---
        onAuthStateChanged(auth, (user) => {
            const overlay = document.getElementById('login-overlay');
            const content = document.getElementById('app-content');
            
            if (user) {
                // Logged In
                currentUser = user;
                overlay.classList.add('hidden');
                content.classList.remove('hidden');
                
                // Show user info
                document.getElementById('user-info').innerHTML = `
                    <img src="${user.photoURL}" class="w-4 h-4 rounded-full mr-1">
                    <span>${user.displayName}</span>
                `;
                
                // Init app data if not already
                if (document.getElementById('routeSelect').options.length === 1) {
                    initApp();
                }
            } else {
                // Not Logged In
                currentUser = null;
                overlay.classList.remove('hidden');
                content.classList.add('hidden');
            }
        });

        // --- DATA & UI ---
        const routes = [
            "AK_VT (An Khánh - Việt Thành)", "BL-HX (Bình Lợi - Hỏa Xa)", "BT_TDA (Bình Triệu - Thanh Đa)",
            "BT_HBP (Bình Thái - Hiệp Bình Phước)", "BT_HX (Bình Triệu - Hỏa Xa)", "CL-TDD (Cát Lái - Thủ Đức Đông)",
            "CL-PH (Cát Lái - Phú Hữu)", "CL-SM (Cát Lái - Sao Mai)", "NR Intel (Nhánh rẽ Intel)",
            "CNC-IT (Công Nghệ Cao - Intel)", "CL-CNC (Cát Lái - Công Nghệ Cao)", "CNC-TNP (Công Nghệ Cao - Tăng Nhơn Phú)",
            "HBP-HX (Hiệp Bình Phước - Hỏa Xa)", "HBP-BT (Hiệp Bình Phước - Bình Triệu)", "HBP-TL (Hiệp Bình Phước - Thạnh Lộc)",
            "HBP-BL (Hiệp Bình Phước - Bình Lợi)", "HX-HH (Hỏa Xa - Hòa Hưng)", "HX-TSN (Hỏa Xa - Tân Sơn Nhất)",
            "HM-TL (Hóc Môn - Thạnh Lộc)", "HM-HBP (Hóc Môn - Hiệp Bình Phước)", "HM-HX (Hóc Môn - Hỏa Xa)",
            "LT1-ĐH (Linh Trung 1 - Đông Hòa)", "NMN TĐ-LT1 (NMN Thủ Đức - Linh Trung 1)", "TNP-IT (Tăng Nhơn Phú - Intel)",
            "TC-TĐ (Tân Cảng 2 - Thảo Điền)", "TC-XL (Tân Cảng 2 - Xa Lộ)", "TC-AK (Tân Cảng 2 - An Khánh)",
            "TĐ-AK-VT (Thủ Đức - An Khánh - Việt Thành)", "TH-ĐT (Tân Hiệp - Đông Thạnh)", "TĐ-LT2 (Thủ Đức - Linh Trung 2)",
            "TĐ-BT (Thủ Đức - Bình Thái)", "TĐ-TDA (Thủ Đức - Thanh Đa)", "TĐ-NMĐ (Thủ Đức - NMĐ Thủ Đức)",
            "TĐ-VKC-TC (Thủ Đức - Vikimco - Tân Cảng)", "TĐ-TDIEN (Thủ Đức - Thảo Điền)", "NR IT (Nhánh rẽ Intel 176-7)",
            "TĐ-TĐB-IT (Thủ Đức - TĐ Bắc - Intel)", "TĐ-NMN TĐ (Thủ Đức - NMN Thủ Đức)", "TĐB-BA (Thủ Đức Bắc - Bình An)",
            "TA-LT2 (Thuận An - Linh Trung 2)", "XL-TC (Xa Lộ - Tân Cảng)", "XL-HX (Xa Lộ - Hỏa Xa)",
            "XL-ĐK (Xa Lộ - Đa Kao)", "CB-TQ (Cầu Bông - Tân Quy)", "CB-CC_CB-ĐH (Cầu Bông - Củ Chi/Đức Hòa)",
            "CB-TPT (Cầu Bông - Tân Phú Trung)", "CB-TH (Cầu Bông - Tân Hiệp)", "ĐT-TH (Đông Thạnh - Tân Hiệp)",
            "CB-ĐN (Cầu Bông - Đông Nam)", "NR ĐNAM (Nhánh rẽ Đông Nam)", "CC-KCNTB (Củ Chi 2 - KCN Trảng Bàng)",
            "CC-CC2 (Củ Chi 2 - Củ Chi)", "CC-PHĐ (Củ Chi 2 - Phú Hòa Đông)", "CC-BĐ (Củ Chi 2 - Bàu Đưng)",
            "HM-ĐT (Hóc Môn - Đông Thạnh)", "HM-ĐN (Hóc Môn - Đông Nam)", "PHĐ-TQ-TĐ (Phú Hòa Đông - Tân Quy - Tân Định)",
            "PHĐ-TĐ (Phú Hòa Đông - Tân Định)"
        ];

        const categories = [
            {
                id: "A", title: "A. HSQLVH (Vận hành)", 
                items: [
                    "Thông số kỹ thuật ĐZ", "Bảng theo dõi đóng cắt", "Bảng Theo dõi Sự cố", "Bảng theo dõi Phụ tải",
                    "Bảng Theo dõi KT hành lang", "Bảng theo dõi đại tu", "Bảng tổng hợp tồn tại",
                    "Bảng phân bố cột", "Bảng giao chéo", "Bảng đo độ võng",
                    "Báo cáo nhiệt độ (6 tháng)", "Báo cáo điện trở (1 năm)",
                    "Hồ sơ thứ tự pha", "Hình Ảnh trụ", "Biên bản KTĐK ngày (1 tháng)",
                    "Biên bản KTĐK đêm (3 tháng)", "Hồ sơ theo dõi nhà/công trình"
                ]
            },
            {
                id: "B", title: "B. HSQLKT (Kỹ thuật)", 
                subsections: [
                    {
                        title: "I. Hồ sơ thiết kế",
                        items: ["Hồ sơ móng trụ", "Hồ sơ đền bù", "Hồ sơ nghiệm thu", "Hồ sơ thiết kế", "Hồ sơ dự thầu"]
                    },
                    {
                        title: "II. Hồ sơ hoàn công",
                        items: ["HS hoàn công móng trụ", "HS hoàn công trụ", "HS hoàn công dây dẫn/chống sét",
                                "HS hoàn công tiếp địa", "Biên bản nghiệm thu", "Tài liệu nhà chế tạo"]
                    }
                ]
            }
        ];

        function initApp() {
            const select = document.getElementById('routeSelect');
            routes.forEach(route => {
                const opt = document.createElement('option');
                const code = route.split(' ')[0].replace(/[^a-zA-Z0-9-_]/g, '_'); 
                opt.value = code;
                opt.textContent = route;
                select.appendChild(opt);
            });

            select.addEventListener('change', (e) => {
                currentRouteCode = e.target.value;
                loadData();
            });

            document.getElementById('globalFileInput').addEventListener('change', handleFileSelect);
            renderTable({});
        }

        window.renderTable = (data, isNew = false) => {
            const tbody = document.getElementById('tableBody');
            tbody.innerHTML = '';
            
            // Show update info
            const updateInfoDiv = document.getElementById('last-update-info');
            if (data.updatedBy && data.lastUpdated) {
                const date = new Date(data.lastUpdated).toLocaleString('vi-VN');
                updateInfoDiv.innerHTML = `<i class="fas fa-history"></i> Cập nhật: <b>${date}</b> bởi <b>${data.updatedBy}</b>`;
                updateInfoDiv.classList.remove('hidden');
            } else {
                updateInfoDiv.innerHTML = 'Chưa có dữ liệu cập nhật';
            }

            categories.forEach(cat => {
                const catRow = `<tr class="block md:table-row bg-blue-50 border-b md:border-none mt-4 md:mt-0 rounded-t-lg"><td colspan="5" class="py-2 px-3 text-blue-800 font-bold uppercase text-xs md:text-sm">${cat.title}</td></tr>`;
                tbody.insertAdjacentHTML('beforeend', catRow);

                if (cat.items) {
                    cat.items.forEach((item, index) => {
                        const uniqueKey = `${cat.id}_${index}`;
                        const defaultCheck = isNew ? true : false;
                        renderRow(tbody, uniqueKey, index + 1, item, data[uniqueKey], defaultCheck);
                    });
                }

                if (cat.subsections) {
                    cat.subsections.forEach((sub, subIndex) => {
                        const subRow = `<tr class="block md:table-row bg-gray-50 border-b md:border-none"><td colspan="5" class="py-1 px-3 pl-6 text-gray-700 font-bold italic text-xs">${sub.title}</td></tr>`;
                        tbody.insertAdjacentHTML('beforeend', subRow);
                        sub.items.forEach((item, itemIndex) => {
                            const uniqueKey = `${cat.id}_${subIndex}_${itemIndex}`;
                            const defaultCheck = isNew ? true : false;
                            renderRow(tbody, uniqueKey, itemIndex + 1, item, data[uniqueKey], defaultCheck);
                        });
                    });
                }
            });
        }

        function renderRow(tbody, key, stt, name, rowData = {}, defaultCheck = false) {
            const isChecked = (rowData.hasFile !== undefined) ? rowData.hasFile : defaultCheck;
            const checkedAttr = isChecked ? 'checked' : '';
            const rowClass = isChecked ? 'bg-white opacity-100' : 'bg-gray-100 opacity-60'; 

            const noteVal = rowData.note || '';
            const imageUrl = rowData.imageUrl || '';

            let imageHtml = '';
            if (imageUrl) {
                imageHtml = `
                    <div class="flex items-center mt-2 md:mt-0">
                        <a href="${imageUrl}" target="_blank" class="flex items-center text-blue-600 bg-blue-50 px-2 py-1 rounded border border-blue-200 mr-2">
                            <i class="fas fa-image mr-1"></i> <span class="text-xs">Xem</span>
                        </a>
                        <button onclick="triggerUpload('${key}')" class="text-gray-400 p-1"><i class="fas fa-pen text-xs"></i></button>
                    </div>
                `;
            } else {
                imageHtml = `
                    <button onclick="triggerUpload('${key}')" class="w-full md:w-auto mt-2 md:mt-0 bg-white border border-dashed border-gray-400 text-gray-500 hover:text-blue-500 hover:border-blue-500 px-3 py-1 rounded text-xs flex items-center justify-center transition">
                        <i class="fas fa-cloud-upload-alt mr-1"></i> Ảnh
                    </button>
                `;
            }

            const row = `
                <tr class="block md:table-row mb-3 md:mb-0 rounded-lg shadow-sm md:shadow-none border md:border-b border-gray-200 ${rowClass} transition-all duration-200" id="row-${key}">
                    <td class="block md:table-cell p-3 md:py-2 md:px-4 md:border-none border-b border-gray-100">
                        <div class="flex justify-between items-start md:hidden mb-1">
                            <span class="font-bold text-gray-800 text-sm w-5/6">${stt}. ${name}</span>
                        </div>
                        <span class="hidden md:block font-medium text-gray-800">${name}</span>
                        <span class="hidden md:block text-gray-400 text-xs text-center">${stt}</span>
                    </td>
                    <td class="block md:table-cell p-2 md:py-2 md:px-4 text-center md:align-middle">
                        <div class="flex items-center justify-between md:justify-center">
                            <span class="md:hidden text-xs font-bold text-gray-500 uppercase">Có hồ sơ?</span>
                            <label class="inline-flex items-center p-2 bg-gray-50 rounded md:bg-transparent">
                                <input type="checkbox" data-key="${key}_hasFile" class="form-checkbox text-blue-600 rounded focus:ring-blue-500" ${checkedAttr} onchange="toggleRowStyle(this, '${key}')">
                            </label>
                        </div>
                    </td>
                    <td class="block md:table-cell p-2 md:py-2 md:px-4">
                        <input type="text" data-key="${key}_note" class="w-full border border-gray-300 bg-white rounded px-3 py-2 text-sm focus:outline-none focus:border-blue-500" placeholder="Ghi chú..." value="${noteVal}">
                    </td>
                    <td class="block md:table-cell p-2 md:py-2 md:px-4">
                        <div id="img-container-${key}">${imageHtml}</div>
                        <input type="hidden" data-key="${key}_imageUrl" value="${imageUrl}">
                    </td>
                </tr>
            `;
            tbody.insertAdjacentHTML('beforeend', row);
        }

        window.toggleRowStyle = (checkbox, key) => {
            const row = document.getElementById(`row-${key}`);
            if (checkbox.checked) {
                row.classList.replace('bg-gray-100', 'bg-white');
                row.classList.replace('opacity-60', 'opacity-100');
            } else {
                row.classList.replace('bg-white', 'bg-gray-100');
                row.classList.replace('opacity-100', 'opacity-60');
            }
        };

        window.triggerUpload = (key) => {
            if (!currentRouteCode) { showToast("Vui lòng chọn tuyến đường dây!", "error"); return; }
            currentUploadBtn = key;
            document.getElementById('globalFileInput').click();
        };

        async function handleFileSelect(event) {
            const file = event.target.files[0];
            if (!file || !currentUploadBtn) return;
            if (!currentUser) { showToast("Vui lòng đăng nhập lại", "error"); return; }

            const key = currentUploadBtn;
            const container = document.getElementById(`img-container-${key}`);
            container.innerHTML = `<span class="text-blue-500 text-xs"><i class="fas fa-spinner fa-spin"></i> Uploading...</span>`;

            try {
                const filename = `${key}_${Date.now()}_${file.name}`;
                const storageRef = sRef(storage, `images/${currentRouteCode}/${filename}`);
                await uploadBytes(storageRef, file);
                const downloadURL = await getDownloadURL(storageRef);

                document.querySelector(`input[data-key="${key}_imageUrl"]`).value = downloadURL;
                container.innerHTML = `
                    <div class="flex items-center mt-2 md:mt-0">
                        <a href="${downloadURL}" target="_blank" class="text-green-600 bg-green-50 px-2 py-1 rounded border border-green-200 mr-2 text-xs font-bold"><i class="fas fa-check"></i> Xong</a>
                        <button onclick="triggerUpload('${key}')" class="text-gray-400 p-1"><i class="fas fa-pen text-xs"></i></button>
                    </div>
                `;
                saveData(true); 
            } catch (error) {
                console.error(error);
                showToast("Lỗi upload!", "error");
                container.innerHTML = `<button onclick="triggerUpload('${key}')" class="text-red-500 text-xs">Lỗi. Thử lại</button>`;
            }
            event.target.value = '';
        }

        window.saveData = (silent = false) => {
            if (!currentUser) { showToast("Bạn phải đăng nhập để lưu!", "error"); return; }
            if (!currentRouteCode) { showToast("Chưa chọn hồ sơ!", "error"); return; }

            if(!silent) {
                const btn = document.querySelector('button[onclick="saveData()"]');
                btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i>';
                setTimeout(() => btn.innerHTML = '<i class="fas fa-save"></i>', 1000);
            }

            const inputs = document.querySelectorAll('[data-key]');
            const dataToSave = {};

            inputs.forEach(input => {
                const parts = input.dataset.key.split('_');
                const field = parts.pop();
                const itemKey = parts.join('_');
                if (!dataToSave[itemKey]) dataToSave[itemKey] = {};
                
                if (input.type === 'checkbox') dataToSave[itemKey][field] = input.checked;
                else dataToSave[itemKey][field] = input.value;
            });

            // --- AUDIT LOGGING ---
            dataToSave.lastUpdated = new Date().toISOString();
            dataToSave.updatedBy = currentUser.displayName || currentUser.email;
            dataToSave.updatedEmail = currentUser.email;
            // ---------------------

            const dbRef = ref(db, 'records/' + currentRouteCode);
            set(dbRef, dataToSave)
                .then(() => {
                    if(!silent) showToast("Đã lưu dữ liệu!", "success");
                    // Refresh audit info display immediately
                    const updateInfoDiv = document.getElementById('last-update-info');
                    const date = new Date().toLocaleString('vi-VN');
                    updateInfoDiv.innerHTML = `<i class="fas fa-history"></i> Cập nhật: <b>${date}</b> bởi <b>${dataToSave.updatedBy}</b>`;
                    updateInfoDiv.classList.remove('hidden');
                })
                .catch((error) => {
                    showToast("Lỗi: " + error.message, "error");
                });
        };

        window.loadData = () => {
            if (!currentRouteCode) return;
            const loader = document.getElementById('loading');
            loader.classList.remove('hidden');
            document.getElementById('tableBody').innerHTML = ''; 

            const dbRef = ref(db);
            get(child(dbRef, `records/${currentRouteCode}`)).then((snapshot) => {
                if (snapshot.exists()) {
                    renderTable(snapshot.val(), false);
                    showToast("Đã tải dữ liệu.", "info");
                } else {
                    renderTable({}, true); 
                    showToast("Dữ liệu mới.", "success");
                }
            }).catch((error) => {
                showToast("Lỗi tải dữ liệu.", "error");
            }).finally(() => {
                loader.classList.add('hidden');
            });
        };

        function showToast(message, type = "info") {
            const toast = document.getElementById('toast');
            let bgClass = 'bg-gray-800 text-white';
            if (type === 'error') bgClass = 'bg-red-600 text-white';
            if (type === 'success') bgClass = 'bg-green-600 text-white';

            toast.className = `fixed top-20 left-1/2 transform -translate-x-1/2 px-4 py-3 rounded-lg shadow-xl transition-all duration-300 z-[60] flex items-center font-medium opacity-100 min-w-[200px] justify-center text-sm ${bgClass}`;
            toast.innerHTML = message;
            setTimeout(() => { toast.classList.replace('opacity-100', 'opacity-0'); }, 2500);
        }
    </script>
</body>
</html>
